<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-4.0 plugin-docs plugin-id-default docs-doc-id-relaying/icq-relayer" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">ICQ Relayer | Neutron Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="http://docs.neutron.org/4.0/relaying/icq-relayer"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="4.0"><meta data-rh="true" name="docusaurus_tag" content="docs-default-4.0"><meta data-rh="true" name="docsearch:version" content="4.0"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-4.0"><meta data-rh="true" property="og:title" content="ICQ Relayer | Neutron Docs"><meta data-rh="true" name="description" content="Overview"><meta data-rh="true" property="og:description" content="Overview"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="http://docs.neutron.org/4.0/relaying/icq-relayer"><link data-rh="true" rel="alternate" href="http://docs.neutron.org/4.0/relaying/icq-relayer" hreflang="en"><link data-rh="true" rel="alternate" href="http://docs.neutron.org/4.0/relaying/icq-relayer" hreflang="x-default"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.0eb1cbbd.css">
<link rel="preload" href="/assets/js/runtime~main.ae092e13.js" as="script">
<link rel="preload" href="/assets/js/main.fbeab2aa.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.jpeg" alt="Neutron Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.jpeg" alt="Neutron Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Neutron</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/4.0/">Introduction</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/neutron-org" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/4.0/">4.0</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/relaying/icq-relayer">5.1</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/4.0/relaying/icq-relayer">4.0</a></li><li><a class="dropdown__link" href="/3.0/relaying/icq-relayer">3.0</a></li><li><a class="dropdown__link" href="/2.0/relaying/icq-relayer">2.0</a></li><li><a class="dropdown__link" href="/1.0/relaying/icq-relayer">1.0</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/4.0/">Neutron</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/4.0/relaying/ibc-relayer">Relaying</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/4.0/relaying/ibc-relayer">IBC Relayer</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/4.0/relaying/icq-relayer">ICQ Relayer</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/4.0/tutorials/overview">Tutorials</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/4.0/deployment/testnet">Deployed contracts</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/4.0/other_tools/rehearsal/overview">Other tools</a></div></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for <!-- -->Neutron Docs<!-- --> <b>4.0</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/relaying/icq-relayer">latest version</a></b> (<!-- -->5.1<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Relaying</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">ICQ Relayer</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: 4.0</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>ICQ Relayer</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview">​</a></h2><p><a href="/neutron/modules/interchain-queries/overview">Interchain Queries</a> allow smart contracts to make queries to a remote chain. An ICQ Relayer is a required component for making them possible. It acts as a facilitator between the Neutron chain and a querying chain, gathering queries that are needed to be performed from the Neutron, actually performing them, and eventually making the results available for the Neutron&#x27;s smart contracts. These three main responsibilities are described in details below.</p><p>If you are a smart contracts developer and up to develop your dApp on Neutron, you will most likely need your own ICQ Relayer to manage your Interchain Queries. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="queries-gathering">Queries gathering<a href="#queries-gathering" class="hash-link" aria-label="Direct link to Queries gathering" title="Direct link to Queries gathering">​</a></h3><p>All registered Interchain Queries and their parameters are stored in the eponymous module and available by its <a href="/neutron/modules/interchain-queries/client#queries">query interface</a>. The Relayer utilises the module&#x27;s interface in order to initialise the performing list of queries. This is how the Relayer maintains the list of queries to be executed:</p><ul><li>on initialisation, the ICQ module <code>RegisteredQueries</code> query is executed with the <code>RELAYER_REGISTRY_ADDRESSES</code> parameter used for the <code>Owners</code> field;</li><li>then the parameter <code>RELAYER_REGISTRY_QUERY_IDS</code> will be used to filter out queries if it is not empty;</li><li>during the rest of the run, the Relayer listens to the ICQ module&#x27;s <code>query_update</code> and <code>query_removed</code> <a href="/neutron/modules/interchain-queries/events">events</a> and modifies the queries list and parameters correspondingly.</li></ul><p>The Relayer also listens to the Neutron&#x27;s <code>NewBlockHeader</code> events that are used as a trigger for queries execution. Since each query has its own <code>update_period</code>, the Relayer tracks queries execution height and executes only the queries which update time has come.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="queries-execution">Queries execution<a href="#queries-execution" class="hash-link" aria-label="Direct link to Queries execution" title="Direct link to Queries execution">​</a></h3><p>When the update time comes for a query, the Relayer runs the specified query on the remote chain:</p><ul><li>in case of a KV-query, the Relayer just <a href="https://github.com/neutron-org/neutron-query-relayer/blob/4542045ab24d2735890e70d4dc525677d5f30c8a/internal/proof/proof_impl/get_storage_values.go#L11" target="_blank" rel="noopener noreferrer">reads</a>
necessary KV-keys from the remote chain&#x27;s storage with <a href="https://github.com/cosmos/cosmos-sdk/blob/ae77f0080a724b159233bd9b289b2e91c0de21b5/docs/interfaces/lite/specification.md" target="_blank" rel="noopener noreferrer">Merkle Proofs</a>. Neutron will need these proofs to <a href="https://github.com/neutron-org/neutron/blob/v2.0.3/x/interchainqueries/keeper/msg_server.go#L228" target="_blank" rel="noopener noreferrer">verify</a> validity of KV-results on results submission;</li><li>in case of a TX-query, the Relayer makes a query to the target chain&#x27;s <a href="https://docs.tendermint.com/v0.33/app-dev/indexing-transactions.html#querying-transactions" target="_blank" rel="noopener noreferrer">Tendermint RPC</a>
to search transactions by message types, events and attributes which were emitted during transactions execution and were
<a href="https://docs.tendermint.com/v0.33/app-dev/indexing-transactions.html" target="_blank" rel="noopener noreferrer">indexed</a> by Tendermint. More about Tx query parameters syntax <a href="/neutron/modules/interchain-queries/messages#register-interchain-query">in the dedicated section</a>. When Relayer submits transactions search results to Neutron chain, it <strong>DOES NOT</strong> include events into result (even if events were used for the query), because <a href="https://github.com/tendermint/tendermint/blob/bff63aec83a4cfbb3bba253cfa04737fb21dacb4/types/results.go#L47" target="_blank" rel="noopener noreferrer">events are not deterministic</a>, therefore they can break blockchain consensus. One more important thing about TX queries is that the Relayer is made the way it only searches for and submits transactions within the trusting period of the Tendermint Light Client. Trusting period is usually calculated as <code>2/3 * unbonding_period</code>. Read more about Tendermint Light Client and trusted periods <a href="https://blog.cosmos.network/light-clients-in-tendermint-consensus-1237cfbda104" target="_blank" rel="noopener noreferrer">at this post</a>.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="results-submission">Results submission<a href="#results-submission" class="hash-link" aria-label="Direct link to Results submission" title="Direct link to Results submission">​</a></h3><p>Relayer submits a query result as the following depending on the Relayer&#x27;s configuration:</p><ul><li>simply sending it to the Neutron&#x27;s Interchain Queries module which handles it by storing the result in the blockchain state (KV queries with <code>RELAYER_ALLOW_KV_CALLBACKS</code>=false);</li><li>sending it to the Neutron&#x27;s Interchain Queries module which handles it by storing the result in the blockchain state and passing the result to the owner smart contract (KV queries with <code>RELAYER_ALLOW_KV_CALLBACKS</code>=true);</li><li>passing it to the smart contract that has registered the query (TX queries).</li></ul><p>This means that it&#x27;s the Relayer who pays gas for these actions. Note that KV queries submission are straightforward and therefore cheap whereas TX ones and KV callbacks also include smart contract call and their cost may vary significantly.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="a-bit-of-technical-details-about-queries">A bit of technical details about queries<a href="#a-bit-of-technical-details-about-queries" class="hash-link" aria-label="Direct link to A bit of technical details about queries" title="Direct link to A bit of technical details about queries">​</a></h4><h5 class="anchor anchorWithStickyNavbar_LWe7" id="queries-submission">Queries submission<a href="#queries-submission" class="hash-link" aria-label="Direct link to Queries submission" title="Direct link to Queries submission">​</a></h5><p>The KV queries are submitted in a fire-and-forget way, i.e. they are submitted once per <code>update_period</code> span and never retried forcibly (e.g. on a submission error). The TX queries are a bit more tricky: since they are not stored in the Neutron chain and simply passed to smart contracts, it&#x27;s needed that each tx is passed and handled by the smart contract only once.</p><p>The Relayer uses the <code>BroadcastTxSync</code> messages broadcast type to maintain balance between performance and submission control, but this means that the submission result is not waited for. And here comes an important part related to TX queries. To achieve both submission speed and sequential submission handling, the Relayer fires TX submission messages, remembers the query result as sent, and then in the background retrieves the submission result for the query. If it turns to be a success, the TX is saved as fully processed and will not be sent to the smart contract again. Otherwise, this tx will be marked as failed and will not be sent to the smart contract again during this run. Instead, to prevent repeated submission of transactions which can&#x27;t be successfully handled by the smart contract, the retry will only be possible on Relayer restart.</p><p>As a default when the Relayer submits a TX query result to the Neutron chain and an error occurs in the smart contract during the sudo call, the Relayer will ignore this error and not retry the submission. For all other errors, the Relayer will exit with an error. </p><p>This behaviour cased by the fact that the Relayer is not aware of the smart contract&#x27;s logic and therefore can&#x27;t know whether the error is recoverable or not. Also, the Relayer should treat all other errors (network/balance/wallet) as fatal, exit and let itself be restarted by the admin/system.</p><p>It is strongly recommended to run the Relayer as a daemon to allow easy restart.</p><p>If you want to change the behaviour, you can do so by changing the environment variable <code>RELAYER_IGNORE_ERRORS_REGEX</code>. </p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="beacons-in-tx-queries">Beacons in TX queries<a href="#beacons-in-tx-queries" class="hash-link" aria-label="Direct link to Beacons in TX queries" title="Direct link to Beacons in TX queries">​</a></h5><p>Transactions for a TX query are retrieved from a target chain in ascending order. Since the TX query results aren&#x27;t submitted to the Neutron chain storage (they are processed by smart contracts via Sudo calls right away) there is no way to get the last processed height from the Neutron for a TX query. In order to keep a TX query progress in terms of already processed heights (make further queries, or restart the Relayer and start from the point where the Relayer stopped during the previous run) the Relayer saves progress for each TX query in its own storage. One of the things it stores is the remote chain height, and it gets updated when all transactions from the given height have been submitted to the chain (i.e. submission messages with these transactions have been broadcast). When the next time to execute the query comes, or when the Relayer restarts, this height will be used to retrieve the next batch of transactions. The <code>RELAYER_INITIAL_TX_SEARCH_OFFSET</code> config parameter is tightly coupled with this part of documentation. Read more about it in the <a href="#relayer-application-settings">Relayer application configuration section</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="configuration">Configuration<a href="#configuration" class="hash-link" aria-label="Direct link to Configuration" title="Direct link to Configuration">​</a></h2><p>This section contains description for all the possible config values that the Relayer supports. For example values see the <a href="https://github.com/neutron-org/neutron-query-relayer/blob/main/.env.example" target="_blank" rel="noopener noreferrer">.env.example</a> file in the Relayer&#x27;s repository.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="neutron-chain-node-settings">Neutron chain node settings<a href="#neutron-chain-node-settings" class="hash-link" aria-label="Direct link to Neutron chain node settings" title="Direct link to Neutron chain node settings">​</a></h3><ul><li><code>RELAYER_NEUTRON_CHAIN_RPC_ADDR</code> — RPC address of a Neutron node to interact with (e.g. get events and to submit results);</li><li><code>RELAYER_NEUTRON_CHAIN_REST_ADDR</code> — REST address of a Neutron node to interact with (e.g. get registered queries list);</li><li><code>RELAYER_NEUTRON_CHAIN_HOME_DIR</code> — path to keys directory;</li><li><code>RELAYER_NEUTRON_CHAIN_SIGN_KEY_NAME</code> — name of the key pair to be used by the Relayer;</li><li><code>RELAYER_NEUTRON_CHAIN_TIMEOUT</code> — timeout for Neutron RPC and REST calls;</li><li><code>RELAYER_NEUTRON_CHAIN_GAS_PRICES</code> — the price for a unit of gas used by the Relayer;</li><li><code>RELAYER_NEUTRON_CHAIN_GAS_LIMIT</code> — the maximum price to be paid for a single submission;</li><li><code>RELAYER_NEUTRON_CHAIN_GAS_ADJUSTMENT</code> — gas multiplier used in order to avoid underestimating;</li><li><code>RELAYER_NEUTRON_CHAIN_CONNECTION_ID</code> — Neutron chain connection ID; Relayer will only relay events for this connection;</li><li><code>RELAYER_NEUTRON_CHAIN_DEBUG</code> — flag to run neutron chain provider in debug mode;</li><li><code>RELAYER_NEUTRON_CHAIN_KEYRING_BACKEND</code> — described <a href="https://docs.cosmos.network/main/user/run-node/keyring#available-backends-for-the-keyring" target="_blank" rel="noopener noreferrer">here</a>;</li><li><code>RELAYER_NEUTRON_CHAIN_OUTPUT_FORMAT</code> — Neutron chain provider output format;</li><li><code>RELAYER_NEUTRON_CHAIN_SIGN_MODE_STR</code> — described <a href="https://docs.cosmos.network/main/learn/advanced/transactions#signing-transactions" target="_blank" rel="noopener noreferrer">here</a>, also consider use short variation, e.g. <code>direct</code>.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="target-chain-node-settings">Target chain node settings<a href="#target-chain-node-settings" class="hash-link" aria-label="Direct link to Target chain node settings" title="Direct link to Target chain node settings">​</a></h3><ul><li><code>RELAYER_TARGET_CHAIN_RPC_ADDR</code> — RPC address of a target chain node to interact with (e.g. send queries);</li><li><code>RELAYER_TARGET_CHAIN_ACCOUNT_PREFIX</code> — target chain account prefix;</li><li><code>RELAYER_TARGET_CHAIN_VALIDATOR_ACCOUNT_PREFIX</code> — target chain validator account prefix;</li><li><code>RELAYER_TARGET_CHAIN_TIMEOUT</code> — timeout for target chain RPC calls;</li><li><code>RELAYER_TARGET_CHAIN_DEBUG</code> — flag to run neutron chain provider in debug mode;</li><li><code>RELAYER_TARGET_CHAIN_OUTPUT_FORMAT</code> — target chain provider output format.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="relayer-application-settings">Relayer application settings<a href="#relayer-application-settings" class="hash-link" aria-label="Direct link to Relayer application settings" title="Direct link to Relayer application settings">​</a></h3><ul><li><code>RELAYER_REGISTRY_ADDRESSES</code> — a list of comma-separated smart-contract addresses (registered query owners) for which the Relayer processes interchain queries. If empty, literally all registered queries are processed which is usable if you are up to deploy a public Relayer;</li><li><code>RELAYER_REGISTRY_QUERY_IDS</code> — a list of comma-separated query IDs which complements to <code>RELAYER_REGISTRY_ADDRESSES</code> to further filter out interchain queries being processed. If empty, no queries will be filtered out;</li><li><code>RELAYER_ALLOW_TX_QUERIES</code> — if true, Relayer will process tx queries (if <code>false</code>, Relayer will ignore them). A true value here is mostly usable for a private Relayer because TX queries submission is quite expensive;</li><li><code>RELAYER_ALLOW_KV_CALLBACKS</code> — if <code>true</code>, will pass proofs as sudo callbacks to contracts. A true value here is mostly usable for a private Relayer because KV query callbacks execution is quite expensive. If false, results will simply be submitted to Neutron and become available for smart contracts retrieval;</li><li><code>RELAYER_MIN_KV_UPDATE_PERIOD</code> — minimal period of queries execution and submission. This value is usable for a public Relayer as a rate limiter because it roughly overrides the queries <code>update_period</code> and force queries execution not more often than <code>N</code> blocks;</li><li><code>RELAYER_STORAGE_PATH</code> — path to leveldb storage, will be created on the given path if it doesn&#x27;t exist. It is required if <code>RELAYER_ALLOW_TX_QUERIES</code> is <code>true</code>;</li><li><code>RELAYER_QUERIES_TASK_QUEUE_CAPACITY</code> — capacity of the channel that is used to send messages from subscriber to Relayer. Better set to a higher value to avoid problems with Tendermint websocket subscriptions;</li><li><code>RELAYER_CHECK_SUBMITTED_TX_STATUS_DELAY</code> — delay in seconds between TX query submission and the result handling checking (more about this in the <a href="#a-bit-of-technical-details-about-queries">TX submission section</a>);</li><li><code>RELAYER_INITIAL_TX_SEARCH_OFFSET</code> - Only for transaction queries. If set to non zero and no prior search height exists, it will initially set search height to (last_height - X). One example of usage of it will be if you have lots of old tx&#x27;s on first start you don&#x27;t need. Keep in mind that it will affect each newly created transaction query. To get a better understanding about how this works read the <a href="#beacons-in-tx-queries">dedicated section</a>;</li><li><code>RELAYER_WEBSERVER_PORT</code> — listener address for webserver json api you can query and prometheus metrics;</li><li><code>RELAYER_IGNORE_ERRORS_REGEX</code> - regular expression to match errors that should be ignored. If the error matches the regex, the Relayer will ignore it and will not retry the submission. For any other errors, the Relayer will exit with an error.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="logger-configuration">Logger configuration<a href="#logger-configuration" class="hash-link" aria-label="Direct link to Logger configuration" title="Direct link to Logger configuration">​</a></h3><p>As it is said in the Relayer&#x27;s <a href="https://github.com/neutron-org/neutron-query-relayer#logging" target="_blank" rel="noopener noreferrer">readme</a>, the Relayer uses a little bit modified version of Uber&#x27;s <a href="https://github.com/uber-go/zap" target="_blank" rel="noopener noreferrer">zap.Logger</a>. This modification allows logger configuration via env parameters. See the <a href="https://github.com/neutron-org/neutron-logger#configuration-via-env-variables" target="_blank" rel="noopener noreferrer">logger configuration guide</a> readme for more information.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="prerequisites">Prerequisites<a href="#prerequisites" class="hash-link" aria-label="Direct link to Prerequisites" title="Direct link to Prerequisites">​</a></h2><p>Before running the Relayer application for production purposes, you need to <a href="#setting-up-relayer-wallet">create a wallet for the Relayer</a>, and set up the <a href="#configuration">configuration</a>. Also you need to have <a href="#getting-server-nodes-for-neutron-and-target-chain">nodes that will serve for the Relayer&#x27;s needs</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="setting-up-relayer-wallet">Setting up Relayer wallet<a href="#setting-up-relayer-wallet" class="hash-link" aria-label="Direct link to Setting up Relayer wallet" title="Direct link to Setting up Relayer wallet">​</a></h3><ol><li>The keyring folder for Relayer&#x27;s usage is configured by the <code>RELAYER_NEUTRON_CHAIN_HOME_DIR</code> variable. The easiest way is to run <code>neutrond keys</code> from the cloned <a href="https://github.com/neutron-org/neutron" target="_blank" rel="noopener noreferrer">neutron repository</a> and get the default value from the <code>--keyring-dir</code> flag:</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">neutrond keys</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Keyring management commands. These keys may be in any format supported by the</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Tendermint crypto library and can be used by light-clients, full nodes, or any other application</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">that needs to sign with a private key.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Flags:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      --keyring-dir string       The client Keyring directory; if omitted, the default &#x27;home&#x27; directory will be used</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Global Flags:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      --home string         directory for config and data (default &quot;/Users/your-user/.neutrond&quot;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>Then execute <code>neutrond keys add relayer --keyring-backend test</code> to create an account in the default keyring directory;</li><li>Use <code>relayer</code> as the <code>RELAYER_NEUTRON_CHAIN_SIGN_KEY_NAME</code>, <code>test</code> as the <code>RELAYER_NEUTRON_CHAIN_KEYRING_BACKEND</code>, and pass the keyring directory as a volume to the Relayer&#x27;s docker container using the keyring path in the container as the <code>RELAYER_NEUTRON_CHAIN_HOME_DIR</code>;</li><li>Get the Relayer&#x27;s wallet address and top its balance up. If you&#x27;re running the Relayer on the testnet, use the official Neutron faucet. For the mainnet, get some NTRN for the address.</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="getting-server-nodes-for-neutron-and-target-chain">Getting server nodes for Neutron and target chain<a href="#getting-server-nodes-for-neutron-and-target-chain" class="hash-link" aria-label="Direct link to Getting server nodes for Neutron and target chain" title="Direct link to Getting server nodes for Neutron and target chain">​</a></h3><p>The Relayer requires a REST and an RPC nodes for Neutron, and an RPC node for the target chain.</p><p>One of the options here is to run your own nodes. For the Neutron nodes refer to the <a href="/neutron/build-and-run/overview">Build and run</a> section of Neutron docs. For the target chain refer to the respective documentation section of the target chain.</p><p>Another option for both (Neutron and target) chains is to use public nodes. You can find them listed in the <a href="https://github.com/cosmos/chain-registry/tree/master" target="_blank" rel="noopener noreferrer">Cosmos chain registry</a> repository. For example, here&#x27;s <a href="https://github.com/cosmos/chain-registry/blob/master/neutron/chain.json" target="_blank" rel="noopener noreferrer">a list of RPC, REST and gRPC Neutron nodes</a> (look for the <code>&quot;apis&quot;</code> key in the JSON), and you can find similar lists for many other Cosmos chains in the repository.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="running-the-relayer">Running the Relayer<a href="#running-the-relayer" class="hash-link" aria-label="Direct link to Running the Relayer" title="Direct link to Running the Relayer">​</a></h2><ol><li>Make sure you&#x27;ve finished the <a href="#configuration">Configuration</a> part;</li><li>Build Relayer&#x27;s docker image from the Relayer&#x27;s folder:</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">make build-docker</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>Run Relayer in a docker container way:</li></ol><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker run --env-file .env.example -p 9999:9999 neutron-org/neutron-query-relayer</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Notes:</p><ul><li><code>-p 9999:9999</code> exposes the port that allows access to the webserver json api and Relayer&#x27;s metrics powered using Prometheus. The container&#x27;s port will be the same as the <code>RELAYER_LISTEN_ADDR</code> value that is <code>9999</code> by default. Use another value if you are up to use a different port;</li><li>add keyring passing to the volumes list. For example, assign <code>RELAYER_NEUTRON_CHAIN_HOME_DIR=/keyring</code> and run the app as:</li></ul><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker run --env-file .env.example -v /Users/your-user/.neutrond:/keyring -p 9999:9999 neutron-org/neutron-query-relayer</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="webserver-api">Webserver API<a href="#webserver-api" class="hash-link" aria-label="Direct link to Webserver API" title="Direct link to Webserver API">​</a></h2><p>Relayer serves it&#x27;s own JSON API and provides commands for querying info about it.</p><p>It listens on port that is set in <code>RELAYER_LISTEN_ADDR</code> env.</p><p>Commands:</p><ul><li>Print available queries:</li></ul><p><code>go run ./cmd/neutron_query_relayer query</code></p><ul><li>Resubmit failed transactions:</li></ul><p><code>go run ./cmd/neutron_query_relayer exec resubmit-tx &lt;queryId&gt; &lt;transactionHash&gt;</code></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="shutting-the-relayer-down">Shutting the Relayer down<a href="#shutting-the-relayer-down" class="hash-link" aria-label="Direct link to Shutting the Relayer down" title="Direct link to Shutting the Relayer down">​</a></h2><p>During the execution the Neutron ICQ Relayer receives events from Neutron, reads remote chain&#x27;s state, and modifies its own state and the Neutron&#x27; one. In order to reach a reliable and consistent flow the Relayer is designed the way it finishes initialised interactions with its local storage on received <code>SIGINT</code> and <code>SIGTERM</code>. It usually takes a fraction of a second.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/4.0/relaying/ibc-relayer"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">IBC Relayer</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/4.0/tutorials/overview"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Overview</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a><ul><li><a href="#queries-gathering" class="table-of-contents__link toc-highlight">Queries gathering</a></li><li><a href="#queries-execution" class="table-of-contents__link toc-highlight">Queries execution</a></li><li><a href="#results-submission" class="table-of-contents__link toc-highlight">Results submission</a></li></ul></li><li><a href="#configuration" class="table-of-contents__link toc-highlight">Configuration</a><ul><li><a href="#neutron-chain-node-settings" class="table-of-contents__link toc-highlight">Neutron chain node settings</a></li><li><a href="#target-chain-node-settings" class="table-of-contents__link toc-highlight">Target chain node settings</a></li><li><a href="#relayer-application-settings" class="table-of-contents__link toc-highlight">Relayer application settings</a></li><li><a href="#logger-configuration" class="table-of-contents__link toc-highlight">Logger configuration</a></li></ul></li><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a><ul><li><a href="#setting-up-relayer-wallet" class="table-of-contents__link toc-highlight">Setting up Relayer wallet</a></li><li><a href="#getting-server-nodes-for-neutron-and-target-chain" class="table-of-contents__link toc-highlight">Getting server nodes for Neutron and target chain</a></li></ul></li><li><a href="#running-the-relayer" class="table-of-contents__link toc-highlight">Running the Relayer</a></li><li><a href="#webserver-api" class="table-of-contents__link toc-highlight">Webserver API</a></li><li><a href="#shutting-the-relayer-down" class="table-of-contents__link toc-highlight">Shutting the Relayer down</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/">Intro</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/neutron" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.neutron.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/Neutron_org" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/neutron-org/neutron" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Neutron Org. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.ae092e13.js"></script>
<script src="/assets/js/main.fbeab2aa.js"></script>
</body>
</html>